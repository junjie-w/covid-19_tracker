{"version":3,"file":"index.js","sources":["../src/chart.tsx","../src/index.tsx"],"sourcesContent":["import React, {\n  useEffect,\n  useState,\n  useRef,\n  useImperativeHandle,\n  useMemo,\n  forwardRef,\n} from 'react';\n// eslint-disable-next-line no-unused-vars\nimport { Props } from './types';\n\nimport Chart from 'chart.js';\nimport merge from 'lodash/merge';\nimport assign from 'lodash/assign';\nimport find from 'lodash/find';\n\nconst ChartComponent = forwardRef<Chart | undefined, Props>((props, ref) => {\n  const {\n    id,\n    height = 150,\n    width = 300,\n    redraw = false,\n    type,\n    data,\n    options = {},\n    plugins = [],\n  } = props;\n\n  const canvas = useRef<HTMLCanvasElement>(null);\n\n  const computedData = useMemo<Chart.ChartData>(() => {\n    if (typeof data === 'function') {\n      return canvas.current ? data(canvas.current) : {};\n    } else return merge({}, data);\n  }, [data, canvas.current]);\n\n  const [chart, setChart] = useState<Chart>();\n\n  useImperativeHandle<Chart | undefined, Chart | undefined>(ref, () => chart, [\n    chart,\n  ]);\n\n  const renderChart = () => {\n    if (!canvas.current) return;\n\n    setChart(\n      new Chart(canvas.current, {\n        type,\n        data: computedData,\n        options,\n        plugins,\n      })\n    );\n  };\n\n  const onClick = (e: React.MouseEvent<HTMLCanvasElement>) => {\n    if (!chart) return;\n\n    const { getDatasetAtEvent, getElementAtEvent, getElementsAtEvent } = props;\n\n    getDatasetAtEvent && getDatasetAtEvent(chart.getDatasetAtEvent(e), e);\n    getElementAtEvent && getElementAtEvent(chart.getElementAtEvent(e), e);\n    getElementsAtEvent && getElementsAtEvent(chart.getElementsAtEvent(e), e);\n  };\n\n  const updateChart = () => {\n    if (!chart) return;\n\n    if (options) {\n      chart.options = Chart.helpers.configMerge(chart.options, options);\n    }\n\n    if (!chart.config.data) {\n      chart.config.data = computedData;\n      chart.update();\n      return;\n    }\n\n    const { datasets: newDataSets = [], ...newChartData } = computedData;\n    const { datasets: currentDataSets = [] } = chart.config.data;\n\n    // copy values\n    assign(chart.config.data, newChartData);\n    chart.config.data.datasets = newDataSets.map(newDataSet => {\n      // given the new set, find it's current match\n      const currentDataSet = find(\n        currentDataSets,\n        d => d.label === newDataSet.label && d.type === newDataSet.type\n      );\n\n      // There is no original to update, so simply add new one\n      if (!currentDataSet || !newDataSet.data) return newDataSet;\n\n      if (!currentDataSet.data) {\n        currentDataSet.data = [];\n      } else {\n        currentDataSet.data.splice(newDataSet.data.length);\n      }\n\n      // copy in values\n      assign(currentDataSet.data, newDataSet.data);\n\n      // apply dataset changes, but keep copied data\n      return {\n        ...currentDataSet,\n        ...newDataSet,\n        data: currentDataSet.data,\n      };\n    });\n\n    chart.update();\n  };\n\n  const destroyChart = () => {\n    if (chart) chart.destroy();\n  };\n\n  useEffect(() => {\n    renderChart();\n\n    return () => destroyChart();\n  }, []);\n\n  useEffect(() => {\n    if (redraw) {\n      destroyChart();\n      renderChart();\n    } else {\n      updateChart();\n    }\n  }, [props, computedData]);\n\n  return (\n    <canvas\n      height={height}\n      width={width}\n      ref={canvas}\n      id={id}\n      onClick={onClick}\n      data-testid='canvas'\n    />\n  );\n});\n\nexport default ChartComponent;\n","import React, { forwardRef } from 'react';\n// eslint-disable-next-line no-unused-vars\nimport { Props } from './types';\nimport ChartComponent from './chart';\n\nexport const Line = forwardRef<Chart | undefined, Props>((props, ref) => (\n  <ChartComponent {...props} type='line' ref={ref} />\n));\n\nexport const Bar = forwardRef<Chart | undefined, Props>((props, ref) => (\n  <ChartComponent {...props} type='bar' ref={ref} />\n));\n\nexport const HorizontalBar = forwardRef<Chart | undefined, Props>(\n  (props, ref) => <ChartComponent {...props} type='horizontalBar' ref={ref} />\n);\n\nexport const Radar = forwardRef<Chart | undefined, Props>((props, ref) => (\n  <ChartComponent {...props} type='radar' ref={ref} />\n));\n\nexport const Doughnut = forwardRef<Chart | undefined, Props>((props, ref) => (\n  <ChartComponent {...props} type='doughnut' ref={ref} />\n));\n\nexport const PolarArea = forwardRef<Chart | undefined, Props>((props, ref) => (\n  <ChartComponent {...props} type='polarArea' ref={ref} />\n));\n\nexport const Bubble = forwardRef<Chart | undefined, Props>((props, ref) => (\n  <ChartComponent {...props} type='bubble' ref={ref} />\n));\n\nexport const Pie = forwardRef<Chart | undefined, Props>((props, ref) => (\n  <ChartComponent {...props} type='pie' ref={ref} />\n));\n\nexport const Scatter = forwardRef<Chart | undefined, Props>((props, ref) => (\n  <ChartComponent {...props} type='scatter' ref={ref} />\n));\n\nexport default ChartComponent;\n"],"names":["ChartComponent","forwardRef","props","ref","id","height","width","redraw","type","data","options","plugins","canvas","useRef","computedData","useMemo","current","merge","useState","chart","setChart","useImperativeHandle","renderChart","Chart","onClick","e","getDatasetAtEvent","getElementAtEvent","getElementsAtEvent","updateChart","helpers","configMerge","config","update","datasets","newDataSets","newChartData","currentDataSets","assign","map","newDataSet","currentDataSet","find","d","label","splice","length","destroyChart","destroy","useEffect","React","Line","Bar","HorizontalBar","Radar","Doughnut","PolarArea","Bubble","Pie","Scatter"],"mappings":"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"}